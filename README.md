# RDCVC

A Comprehensive Neural Network and Optimization Framework for Building Accurate BIM Models, Conducting Transfer
Learning, and Multi-Objective Optimization using Neural Networks and Optimization Algorithms.

## ANN

框架主要借鉴了[torch_base](https://github.com/ahangchen/torch_base)
，可以查看原框架的[解析](https://github.com/ahangchen/windy-afternoon/blob/master/ml/pratice/torch_best_practice.md)，[知乎](https://zhuanlan.zhihu.com/p/409662511)。

通过命令行参数，执行 ./scripts/train.py 或者 test.py 进行训练或测试。

### args

#### COMMON

|    **PROMPT**     |             **default**             | **help**                                                                                                                                                             |
| :---------------: | :---------------------------------: | -------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|   --model_type    |            'base_model'             | 模型的名字                                                                                                                                                           |
|      --seed       |                1234                 |                                                                                                                                                                      |
|    --data_type    |           'base_dataset'            | 数据集的名字                                                                                                                                                         |
|   --save_prefix   |               'pref'                | 训练时：实验的名字，可以备注自己改了那些重要组件，具体的参数，会用于创建保存模型的目录；测试时：测试的名字，可以备注测试时做了哪些配置，会用于创建保存测试结果的目录 |
| --load_model_path | 'checkpoints/base_model_pref/0.pth' | 模型加载路径，训练时，作为预训练模型路径，测试时，作为待测模型路径，                                                                                                 |
| --load_not_strict |                                     | 'allow to load only common state dicts'                                                                                                                              |
|    --val_list     | '/data/dataset1/list/base/val.txt'  | 训练时可以传入验证集 path，测试时可以传入测试集 path                                                                                                                 |                                                                                                                                                                 |

#### TRAIN

|     **PROMPT**      | **default** | **help**                       |
| :-----------------: | :---------: | ------------------------------ |
|        --lr         |    1e-3     | 学习率                         |
|     --momentum      |     0.9     | SGD 的动量，Adam 的 α 参数     |
|       --beta        |    0.999    | Adam 的 β 参数                 |
| --weight-decay,--wd |      0      | 权重衰减率                     |
|     --model_dir     |     ''      | 'leaveblank,autogenerated'     |
|    --train_path     |     ''      | 模型的存储目录，留空，不用传入 |
|    --batch_size     |     16      | 训练时的 batch size            |
|      --epochs       |     100     | 模型训练 epoch 数              |
| --print_freq_batch  |      1      | 训练时的打印频率（batch）      |
| --print_freq_epoch  |      1      | 训练时的打印频率（epoch）      |

#### TEST

| **PROMPT**        | **default** | **help**                                         |
| ----------------- | ----------- | ------------------------------------------------ |
| --save_viz        |             | 控制是否保存可视化结果的开关，仅针对 cv 任务     |
| --result_dir      | ''          | 可视化结果和测试结果的存储目录，留空，不用传入， |
| --from_checkpoint |             | test from a checkpoint                           |

## 项目文件结构

### 原 torch_base 框架代码结构

```
torch_base
├── checkpoints # 存放模型的地方
├── data        # 定义各种用于训练测试的dataset
├── eval.py     # 测试代码
├── loss.py     # 定义各种花里胡哨的loss
├── metrics.py  # 定义各种约定俗成的评估指标
├── model       # 定义各种实验中的模型
├── options.py  # 定义各种实验参数，以命令行形式传入
├── README.md   # 介绍一下自己的repo
├── scripts     # 各种训练，测试脚本
├── train.py    # 训练代码
└── utils       # 各种工具代码
```

checkpoints 比较简单，每次训练的模型各自放在一个目录里，scripts 目录可以放每次训练或测试用的命令脚本，README.md 往往是这个
repo 的门面，可以放一些介绍性的内容；其他都是代码目录。

```filetree
.
├── checkpoints
│   ├── GA
│   └── NN
├── data
│   ├── processed
│   ├── raw
│   ├── test
│   └── train
└── src
    ├── RDCVC
    │   ├── models
    │   │   ├── optimization
    │   │   │   ├── GA
    │   │   │   ├── NSGA
    │   │   │   └── utils
    │   │   └── prediciton
    │   │       ├── CVCNet
    │   │       ├── LinerRegression
    │   │       ├── Others
    │   │       └── TreeMethod
    │   ├── notebooks
    │   ├── scripts
    │   └── utils
    └── tests
        ├── others
        └── RDCVC
DOPNN/
    │   main.py:主程序，包含训练、验证、测试和预测
    │   README.md
    │  
    ├─checkpoints/:保存训练好的模型
    ├─configs/:配置文件
    │       condig.yaml
    │
    ├─data/:原始数据
    ├─datasets/:加载数据
    │       data_loader.py
    │
    ├─logs/:日志
    ├─models/:模型
    │       model.py
    │
    └─utils/:辅助模块，可以是日志、评价指标计算等等
            metrics.py
            utils.py    
```

> 各文件夹目录下以“_”开头的文件均为模板文件，例如“datasets/_data_loader.py”为 data_loader 的模板

## 模型

### CVCNet

model_type:

```
cvcnet-mtl-mlp_<inputs_dim>_<num_layers>_<num_tasks_experts>_<num_shared_experts>_<expert_units, 32:32>_<tower_units, 32:32>
```